<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title> Salary Calculator Â· å°è²“è²“ x å¤§ç‹—ç‹—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: linear-gradient(135deg, #f7f3ea, #fdfaf4);
      --card-bg: #fffcf8;
      --accent: #d8a657;
      --accent-strong: #b27a2b;
      --accent-soft: rgba(216, 166, 87, 0.12);
      --accent-dog: #ffb347;
      --text-main: #222222;
      --text-muted: #78716c;
      --border-subtle: #e4d8c2;
      --danger: #f0625f;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.10);
    }

    body.dark {
      --bg: radial-gradient(circle at top, #1a1209, #050505);
      --card-bg: #151515;
      --accent: #d5a44e;
      --accent-strong: #f2c76b;
      --accent-soft: rgba(213, 164, 78, 0.12);
      --accent-dog: #f2c76b;
      --text-main: #f5f5f5;
      --text-muted: #a3a3a3;
      --border-subtle: #2c2c2c;
      --danger: #f97373;
      --shadow-soft: 0 12px 30px rgba(0, 0, 0, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      padding: 14px;
      display: flex;
      justify-content: center;
      transition: background 0.25s ease, color 0.25s ease;
    }

    main {
      width: 100%;
      max-width: 560px;
    }

    header {
      margin-bottom: 14px;
      padding-right: 40px;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.icon {
      font-size: 1.5rem;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .tagline {
      margin-top: 4px;
      font-size: 0.78rem;
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(216, 166, 87, 0.08);
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 14px 12px;
      margin-bottom: 12px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.04);
      backdrop-filter: blur(10px);
    }

    .card-title {
      font-size: 0.96rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.badge {
      font-size: 0.74rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .field {
      flex: 1 1 140px;
      min-width: 140px;
    }

    label {
      font-size: 0.78rem;
      display: block;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    input[type="date"],
    input[type="time"],
    input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 0.9rem;
      outline: none;
      background: rgba(255, 252, 248, 0.95);
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, transform 0.05s ease;
      color: var(--text-main);
    }

    body.dark input[type="date"],
    body.dark input[type="time"],
    body.dark input[type="number"] {
      background: #111111;
    }

    input[type="date"]:focus,
    input[type="time"]:focus,
    input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(216, 166, 87, 0.50);
      background: #ffffff;
      transform: translateY(-0.5px);
    }

    input[type="checkbox"] {
      transform: scale(1.1);
      margin-right: 6px;
      accent-color: var(--accent);
    }

    .checkbox-inline {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.82rem;
      margin-top: 4px;
      color: var(--text-main);
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.78rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(255, 252, 248, 0.95);
      font-size: 0.8rem;
      color: var(--accent-strong);
      border: 1px solid rgba(216, 166, 87, 0.40);
      white-space: nowrap;
    }

    .pill.dog {
      background: rgba(255, 244, 221, 0.9);
      color: #8a5a1a;
      border-color: rgba(255, 179, 71, 0.5);
    }

    .pill strong {
      font-weight: 600;
    }

    button {
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      font-size: 0.88rem;
      cursor: pointer;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition: transform 0.08s ease, box-shadow 0.15s ease, background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-dog));
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(216, 166, 87, 0.55);
      justify-content: center;
    }

    button.primary:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 2px 6px rgba(216, 166, 87, 0.60);
    }

    button.danger {
      background: var(--danger);
      color: #ffffff;
      justify-content: center;
      font-size: 0.76rem;
      padding: 6px 10px;
      box-shadow: 0 3px 8px rgba(240, 98, 95, 0.45);
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
      transform: none;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 6px;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .summary-item {
      flex: 1 1 140px;
      min-width: 140px;
      border-radius: 12px;
      background: rgba(255, 252, 248, 0.96);
      border: 1px solid var(--border-subtle);
      padding: 6px 8px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    body.dark .summary-item {
      background: #111111;
    }

    .summary-item strong {
      font-size: 0.9rem;
    }

    .summary-label {
      color: var(--text-muted);
    }

    .chip-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding-top: 4px;
    }

    .section-label-small {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 8px;
      margin-bottom: 4px;
    }

    .months-container {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 320px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .month-card {
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(255, 252, 248, 0.97);
      padding: 6px 8px;
      font-size: 0.8rem;
    }

    body.dark .month-card {
      background: #111111;
    }

    .month-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
      gap: 6px;
    }

    .month-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .month-title {
      font-weight: 600;
    }

    .month-sub {
      font-size: 0.76rem;
      color: var(--text-muted);
    }

    .month-toggle {
      background: transparent;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 3px 8px;
      font-size: 0.78rem;
      box-shadow: none;
      color: var(--text-muted);
      min-width: 44px;
      justify-content: center;
    }

    .month-card.open .month-toggle {
      color: var(--accent-strong);
      border-color: rgba(216, 166, 87, 0.6);
      background: rgba(216, 166, 87, 0.08);
    }

    .month-body {
      margin-top: 4px;
      display: none;
      border-top: 1px dashed var(--border-subtle);
      padding-top: 4px;
    }

    .month-card.open .month-body {
      display: block;
      animation: monthFade 0.18s ease-out;
    }

    @keyframes monthFade {
      from { opacity: 0; transform: translateY(-2px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .day-row {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      padding: 3px 0;
    }

    .day-main {
      flex: 1 1 auto;
      min-width: 0;
    }

    .day-line {
      font-size: 0.78rem;
    }

    .day-meta {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .day-tags {
      display: inline-flex;
      gap: 4px;
      margin-left: 4px;
      font-size: 0.7rem;
    }

    .tag-pill {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(216, 166, 87, 0.5);
      color: var(--accent-strong);
      background: rgba(216, 166, 87, 0.08);
    }

    .day-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      white-space: nowrap;
    }

    .day-pay {
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .day-pay span.icon {
      font-size: 1rem;
    }

    /* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */
    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 20;
      background: rgba(17, 17, 17, 0.06);
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid rgba(228, 216, 194, 0.9);
      font-size: 0.85rem;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.25);
      backdrop-filter: blur(8px);
      color: #5b3b16;
    }

    body.dark .theme-toggle {
      background: rgba(0, 0, 0, 0.75);
      border-color: #3a2a12;
      color: #f2c76b;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
    }

    .theme-toggle span {
      display: inline-block;
      transition: transform 0.15s ease;
    }

    .theme-toggle:active span {
      transform: translateY(1px) rotate(-10deg);
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      header h1 {
        font-size: 1.3rem;
      }
      .card {
        padding: 12px 10px;
        border-radius: 16px;
      }
      .row {
        flex-direction: column;
      }
      .field {
        width: 100%;
      }
      .btn-row {
        flex-direction: column;
        align-items: stretch;
      }
      .btn-row button {
        width: 100%;
        justify-content: center;
      }
      .summary-item {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ›ä¸»é¡Œ">
    <span>ğŸŒğŸ¶</span>
  </button>

  <main>
    <header>
      <h1>
        <span class="icon">ğŸ±ğŸ¶</span>
        Ning's Salary
      </h1>
      <p>å°è²“è²“çš„æ‰“å·¥ç­è¡¨ï¼Œäº¤çµ¦å¤§ç‹—ç‹—å¹«å¦³ç®—å¥½è–ªæ°´ã€‚</p>
      <div class="tagline">
        <span>â±</span> 10 åˆ†é˜ç‚ºå–®ä½ï¼Œè‡ªå‹•åˆ‡åŸºæœ¬ / åŠ ç­ 1.33 / 1.66 å€ã€‚
      </div>
    </header>

    <!-- åŸºæœ¬è¨­å®š -->
    <section class="card">
      <div class="card-title">
        åŸºæœ¬è¨­å®š
        <span class="badge">Step 0</span>
      </div>
      <div class="row">
        <div class="field">
          <label for="wage">æ™‚è–ªï¼ˆå…ƒï¼‰</label>
          <input type="number" id="wage" value="200" min="0" step="1" />
        </div>
      </div>
      <p class="muted">
        ç›®å‰ä»¥æ¯å°æ™‚ <strong id="wagePreview">200</strong> å…ƒè¨ˆç®—ã€‚ä¹‹å¾Œæœ‰èª¿è–ªå†æ”¹é€™è£¡å°±å¥½ã€‚
      </p>
    </section>

    <!-- ä»Šæ—¥è¼¸å…¥ -->
    <section class="card">
      <div class="card-title">
        ä»Šæ—¥ç­åˆ¥è¼¸å…¥
        <span class="badge">Step 1</span>
      </div>
      <div class="row">
        <div class="field">
          <label for="dateInput">æ—¥æœŸ</label>
          <input type="date" id="dateInput" />
        </div>
        <div class="field">
          <label for="startInput">ä¸Šç­æ™‚é–“ï¼ˆ10 åˆ†é˜åˆ»åº¦ï¼‰</label>
          <input type="time" id="startInput" step="600" />
        </div>
        <div class="field">
          <label for="endInput">ä¸‹ç­æ™‚é–“ï¼ˆ10 åˆ†é˜åˆ»åº¦ï¼‰</label>
          <input type="time" id="endInput" step="600" />
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label for="breakInput">ä¼‘æ¯åˆ†é˜æ•¸</label>
          <input type="number" id="breakInput" value="40" min="0" step="10" />
          <div class="muted">ä¼‘æ¯ä¹Ÿæ˜¯ 10 åˆ†é˜ä¸€è·³å°±å¥½ï½</div>
        </div>
        <div class="field" style="align-self:flex-end;">
          <label>&nbsp;</label>
          <div class="checkbox-inline">
            <input type="checkbox" id="holidayInput" />
            <span>åœ‹å®šå‡æ—¥ï¼ˆåŠ ç™¼é›™è–ªï¼‰</span>
          </div>
          <div class="muted">åªæœ‰å‹åŸºæ³•åœ‹å®šå‡æ—¥æ‰ç®—é›™è–ªï¼Œå…¶ä»–ç…§å¹³æ—¥ã€‚</div>
        </div>
      </div>

      <div class="pill-row">
        <div class="pill">
          ğŸ•’ ä»Šæ—¥å·¥æ™‚ï¼š<strong id="todayHoursText">0 å°æ™‚</strong>
        </div>
        <div class="pill dog">
          ğŸ’° ä»Šæ—¥è–ªæ°´è©¦ç®—ï¼š<strong id="todayPayText">0 å…ƒ</strong>
        </div>
      </div>

      <div class="btn-row">
        <button class="primary" id="addDayBtn">
          â• åŠ å…¥é€™ä¸€å¤©
        </button>
        <span class="muted">
          æœƒå­˜åˆ°ä¸‹é¢ç´€éŒ„ï¼Œä¹‹å¾Œæ‰“é–‹é€™å€‹é é¢ä¹Ÿé‚„åœ¨ã€‚
        </span>
      </div>
    </section>

    <!-- æœˆç¸½è¡¨ + ç´€éŒ„ -->
    <section class="card">
      <div class="card-title">
        ç¸½çµ & æœˆç¸½è¡¨
        <span class="badge">Step 2</span>
      </div>

      <div class="summary-row" id="summaryRow" style="display:none;">
        <div class="summary-item">
          <div class="summary-label">åŸºæœ¬å·¥æ™‚ï¼ˆâ‰¤ 8 å°æ™‚ï¼‰</div>
          <strong id="sumBaseHours">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¬¬ 9ï½10 å°æ™‚ï¼ˆ1.33 å€ï¼‰</div>
          <strong id="sumOt910">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¬¬ 11 å°æ™‚èµ·ï¼ˆ1.66 å€ï¼‰</div>
          <strong id="sumOt11">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¸½è–ªæ°´</div>
          <strong id="sumTotalPay">0</strong>
          <span class="muted">å…ƒ</span>
        </div>
      </div>

      <p class="muted" style="margin-top:6px;">
        é€™é‚Šæ˜¯ç›®å‰æ‰€æœ‰å·²å„²å­˜çš„ã€Œç¸½å·¥æ™‚ & ç¸½è–ªæ°´ã€ï¼Œä»¥åŠæ¯å€‹æœˆä»½çš„å±•é–‹æ˜ç´°ã€‚
      </p>

      <div class="section-label-small">æœˆç¸½è¡¨</div>
      <div id="emptyHint" class="chip-empty">
        é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ï¼Œå…ˆåœ¨ä¸Šé¢è¼¸å…¥ä¸€å¤©ç­åˆ¥ï¼ŒæŒ‰ã€ŒåŠ å…¥é€™ä¸€å¤©ã€çœ‹çœ‹å§ã€‚
      </div>

      <div class="months-container" id="monthsContainer">
        <!-- JS ç”¢ç”Ÿæœˆå¡ç‰‡ -->
      </div>

      <p class="muted" style="margin-top:6px;">
        æ‰€æœ‰è³‡æ–™åªå­˜åœ¨å¦³é€™æ”¯æ‰‹æ©Ÿï¼é›»è…¦çš„ç€è¦½å™¨è£¡ï¼Œä¸æœƒä¸Šå‚³åˆ°ä»»ä½•åœ°æ–¹ã€‚
      </p>
    </section>
  </main>

    <script>
    const STORAGE_KEY = "ningsSalaryRecords_v3_dogmode";

    const wageInput = document.getElementById("wage");
    const wagePreview = document.getElementById("wagePreview");
    const dateInput = document.getElementById("dateInput");
    const startInput = document.getElementById("startInput");
    const endInput = document.getElementById("endInput");
    const breakInput = document.getElementById("breakInput");
    const holidayInput = document.getElementById("holidayInput");

    const todayHoursText = document.getElementById("todayHoursText");
    const todayPayText = document.getElementById("todayPayText");

    const addDayBtn = document.getElementById("addDayBtn");

    const sumBaseHoursEl = document.getElementById("sumBaseHours");
    const sumOt910El = document.getElementById("sumOt910");
    const sumOt11El = document.getElementById("sumOt11");
    const sumTotalPayEl = document.getElementById("sumTotalPay");
    const emptyHint = document.getElementById("emptyHint");
    const summaryRow = document.getElementById("summaryRow");
    const monthsContainer = document.getElementById("monthsContainer");

    const themeToggleBtn = document.getElementById("themeToggle");

    let records = [];
    let currentTheme = "light";

    function toMinutes(t) {
      if (!t) return null;
      const parts = t.split(":");
      if (parts.length !== 2) return null;
      const h = Number(parts[0]);
      const m = Number(parts[1]);
      if (Number.isNaN(h) || Number.isNaN(m)) return null;
      return h * 60 + m;
    }

    function roundTo2(x) {
      return Math.round(x * 100) / 100;
    }

    function formatHours(h) {
      return roundTo2(h).toString();
    }

    function formatMoney(n) {
      return Math.round(n).toString();
    }

    function snapTimeTo10Minutes(inputEl) {
      const val = inputEl.value;
      if (!val) return;
      let [h, m] = val.split(":").map(Number);
      if (Number.isNaN(h) || Number.isNaN(m)) return;
      let rounded = Math.round(m / 10) * 10;
      if (rounded === 60) {
        h = (h + 1) % 24;
        rounded = 0;
      }
      const hh = String(h).padStart(2, "0");
      const mm = String(rounded).padStart(2, "0");
      inputEl.value = `${hh}:${mm}`;
    }

    // âœ… æ­£ç¢ºç‰ˆï¼šåœ‹å®šå‡æ—¥åªæœ‰ã€ŒåŸºæœ¬å·¥æ™‚ã€é›™è–ª
    //   åŸºæœ¬ 8 å°æ™‚ï¼šå¹³æ—¥ 1 å€ï¼Œåœ‹å‡ 2 å€
    //   ç¬¬ 9ï½10 å°æ™‚ï¼šä¸€å¾‹ 1.33 å€ï¼ˆä¸å†ä¹˜ 2ï¼‰
    //   ç¬¬ 11 å°æ™‚èµ·ï¼šä¸€å¾‹ 1.66 å€ï¼ˆä¸å†ä¹˜ 2ï¼‰
    function calcDay() {
      const wage = parseFloat(wageInput.value) || 0;
      const startMin = toMinutes(startInput.value);
      const endMinRaw = toMinutes(endInput.value);
      const breakMin = parseInt(breakInput.value || "0", 10);
      const isHoliday = holidayInput.checked;

      if (startMin == null || endMinRaw == null || wage <= 0) {
        return {
          valid: false,
          totalHours: 0,
          baseHours: 0,
          ot910: 0,
          ot11: 0,
          pay: 0
        };
      }

      let endMin = endMinRaw;
      if (endMin <= startMin) {
        endMin += 24 * 60;
      }

      let workedMin = endMin - startMin - breakMin;
      if (workedMin <= 0) {
        workedMin = 0;
      }

      const totalHours = workedMin / 60;

      const baseHours = Math.min(totalHours, 8);
      let remain = Math.max(totalHours - 8, 0);

      const ot910 = Math.min(remain, 2);
      remain -= ot910;

      const ot11 = Math.max(remain, 0);

      // å…ˆç®—ã€Œä¸å«åœ‹å‡åŠ æˆã€çš„åŸºæœ¬ & åŠ ç­
      const basePayNormal = baseHours * wage;
      const ot910Pay = ot910 * wage * 1.33;
      const ot11Pay = ot11 * wage * 1.66;

      // åªæœ‰åŸºæœ¬å·¥æ™‚åœ¨åœ‹å®šå‡æ—¥é›™è–ª
      const basePay = isHoliday ? basePayNormal * 2 : basePayNormal;

      const pay = basePay + ot910Pay + ot11Pay;

      return {
        valid: true,
        totalHours,
        baseHours,
        ot910,
        ot11,
        pay
      };
    }

    function updateTodayPreview() {
      const info = calcDay();
      todayHoursText.textContent = formatHours(info.totalHours) + " å°æ™‚";
      todayPayText.textContent = formatMoney(info.pay) + " å…ƒ";
      addDayBtn.disabled = !info.valid || info.totalHours <= 0;
    }

    function saveToStorage() {
      try {
        const data = {
          wage: parseFloat(wageInput.value) || 0,
          theme: currentTheme,
          records: records
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.error("localStorage error:", e);
      }
    }

    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return;
        const data = JSON.parse(raw);
        if (data.wage) {
          wageInput.value = data.wage;
          wagePreview.textContent = data.wage;
        }
        if (Array.isArray(data.records)) {
          records = data.records;
        }
        if (data.theme === "dark" || data.theme === "light") {
          applyTheme(data.theme);
        }
      } catch (e) {
        console.error("localStorage parse error:", e);
      }
    }

    function applyTheme(theme) {
      currentTheme = theme;
      if (theme === "dark") {
        document.body.classList.add("dark");
        themeToggleBtn.querySelector("span").textContent = "ğŸŒ™ğŸ•â€ğŸ¦º";
      } else {
        document.body.classList.remove("dark");
        themeToggleBtn.querySelector("span").textContent = "ğŸŒğŸ¶";
      }
    }

    function renderRecords() {
      monthsContainer.innerHTML = "";

      if (records.length === 0) {
        emptyHint.style.display = "block";
        summaryRow.style.display = "none";
        sumBaseHoursEl.textContent = "0";
        sumOt910El.textContent = "0";
        sumOt11El.textContent = "0";
        sumTotalPayEl.textContent = "0";
        return;
      } else {
        emptyHint.style.display = "none";
        summaryRow.style.display = "flex";
      }

      let sumBase = 0;
      let sum910 = 0;
      let sum11 = 0;
      let sumPay = 0;

      const monthMap = {};

      records.forEach((rec, idx) => {
        const base = Number(rec.baseHours) || 0;
        const ot910 = Number(rec.ot910) || 0;
        const ot11 = Number(rec.ot11) || 0;
        const pay = Number(rec.pay) || 0;

        sumBase += base;
        sum910 += ot910;
        sum11 += ot11;
        sumPay += pay;

        let monthKey = "æœªå¡«æ—¥æœŸ";
        if (rec.date && rec.date.length >= 7) {
          monthKey = rec.date.slice(0, 7);
        }

        if (!monthMap[monthKey]) {
          monthMap[monthKey] = {
            baseHours: 0,
            ot910: 0,
            ot11: 0,
            pay: 0,
            list: []
          };
        }

        monthMap[monthKey].baseHours += base;
        monthMap[monthKey].ot910 += ot910;
        monthMap[monthKey].ot11 += ot11;
        monthMap[monthKey].pay += pay;

        monthMap[monthKey].list.push({
          index: idx,
          rec: rec
        });
      });

      sumBaseHoursEl.textContent = formatHours(sumBase);
      sumOt910El.textContent = formatHours(sum910);
      sumOt11El.textContent = formatHours(sum11);
      sumTotalPayEl.textContent = formatMoney(sumPay);

      const monthKeys = Object.keys(monthMap).sort((a, b) => {
        if (a === "æœªå¡«æ—¥æœŸ") return 1;
        if (b === "æœªå¡«æ—¥æœŸ") return -1;
        return a < b ? 1 : -1;
      });

      monthKeys.forEach((monthKey) => {
        const monthData = monthMap[monthKey];

        monthData.list.sort((a, b) => {
          const da = a.rec.date || "";
          const db = b.rec.date || "";
          if (da === db) {
            const sa = a.rec.start || "";
            const sb = b.rec.start || "";
            return sa < sb ? -1 : sa > sb ? 1 : 0;
          }
          return da < db ? -1 : 1;
        });

        const monthCard = document.createElement("div");
        monthCard.className = "month-card";

        const header = document.createElement("div");
        header.className = "month-header";

        const main = document.createElement("div");
        main.className = "month-main";

        const title = document.createElement("div");
        title.className = "month-title";
        if (monthKey === "æœªå¡«æ—¥æœŸ") {
          title.textContent = "æœªå¡«æ—¥æœŸ";
        } else {
          const y = monthKey.slice(0, 4);
          const m = monthKey.slice(5, 7);
          title.textContent = `${y} å¹´ ${m} æœˆ`;
        }

        const sub = document.createElement("div");
        sub.className = "month-sub";
        const totalHours = monthData.baseHours + monthData.ot910 + monthData.ot11;
        sub.textContent = `ç¸½å·¥æ™‚ ${formatHours(totalHours)} å°æ™‚ Â· ç¸½è–ªæ°´ ${formatMoney(monthData.pay)} å…ƒ`;

        main.appendChild(title);
        main.appendChild(sub);

        const toggle = document.createElement("button");
        toggle.type = "button";
        toggle.className = "month-toggle";
        toggle.textContent = "å±•é–‹ â–¼";

        header.appendChild(main);
        header.appendChild(toggle);

        const body = document.createElement("div");
        body.className = "month-body";

        monthData.list.forEach((item) => {
          const rec = item.rec;
          const idx = item.index;
          const row = document.createElement("div");
          row.className = "day-row";
          row.dataset.index = String(idx);

          const left = document.createElement("div");
          left.className = "day-main";

          const line = document.createElement("div");
          line.className = "day-line";

          const dateText = rec.date || "æœªå¡«";
          const startText = rec.start || "??:??";
          const endText = rec.end || "??:??";
          const totalH = (Number(rec.baseHours) || 0) + (Number(rec.ot910) || 0) + (Number(rec.ot11) || 0);

          line.textContent = `${dateText} ï½œ ${startText}ï½${endText} ï½œ ${formatHours(totalH)}h`;

          const meta = document.createElement("div");
          meta.className = "day-meta";
          meta.textContent =
            `åŸºæœ¬ ${formatHours(rec.baseHours)}h Â· 9â€“10h ${formatHours(rec.ot910)}h Â· 11+h ${formatHours(rec.ot11)}h`;

          const tags = document.createElement("span");
          tags.className = "day-tags";
          if (rec.holiday) {
            const tag = document.createElement("span");
            tag.className = "tag-pill";
            tag.textContent = "åœ‹å®šå‡æ—¥Ã—2ï¼ˆåªé›™è–ªåŸºæœ¬ï¼‰";
            tags.appendChild(tag);
          }

          meta.appendChild(tags);
          left.appendChild(line);
          left.appendChild(meta);

          const right = document.createElement("div");
          right.className = "day-right";

          const payEl = document.createElement("div");
          payEl.className = "day-pay";
          const icon = document.createElement("span");
          icon.className = "icon";
          icon.textContent = "ğŸ’µ";
          const payText = document.createElement("span");
          payText.textContent = formatMoney(rec.pay) + " å…ƒ";
          payEl.appendChild(icon);
          payEl.appendChild(payText);

          const delBtn = document.createElement("button");
          delBtn.type = "button";
          delBtn.className = "danger";
          delBtn.textContent = "åˆªé™¤";
          delBtn.addEventListener("click", () => {
            const realIdx = parseInt(row.dataset.index || "-1", 10);
            if (!Number.isNaN(realIdx) && realIdx >= 0 && realIdx < records.length) {
              records.splice(realIdx, 1);
              saveToStorage();
              renderRecords();
            }
          });

          right.appendChild(payEl);
          right.appendChild(delBtn);

          row.appendChild(left);
          row.appendChild(right);

          body.appendChild(row);
        });

        header.addEventListener("click", (ev) => {
          const isOpen = monthCard.classList.contains("open");
          if (isOpen) {
            monthCard.classList.remove("open");
            toggle.textContent = "å±•é–‹ â–¼";
          } else {
            monthCard.classList.add("open");
            toggle.textContent = "æ”¶åˆ â–²";
          }
        });

        monthCard.appendChild(header);
        monthCard.appendChild(body);
        monthsContainer.appendChild(monthCard);
      });
    }

    wageInput.addEventListener("input", () => {
      const v = parseFloat(wageInput.value) || 0;
      wagePreview.textContent = v;
      updateTodayPreview();
      saveToStorage();
    });

    function handleTimeInputSnap() {
      snapTimeTo10Minutes(this);
      updateTodayPreview();
    }

    startInput.addEventListener("change", handleTimeInputSnap);
    startInput.addEventListener("blur", handleTimeInputSnap);
    endInput.addEventListener("change", handleTimeInputSnap);
    endInput.addEventListener("blur", handleTimeInputSnap);

    dateInput.addEventListener("input", updateTodayPreview);
    breakInput.addEventListener("input", updateTodayPreview);
    holidayInput.addEventListener("change", updateTodayPreview);

    addDayBtn.addEventListener("click", () => {
      snapTimeTo10Minutes(startInput);
      snapTimeTo10Minutes(endInput);
      const info = calcDay();
      if (!info.valid || info.totalHours <= 0) return;

      const rec = {
        date: dateInput.value || "",
        start: startInput.value || "",
        end: endInput.value || "",
        breakMinutes: parseInt(breakInput.value || "0", 10),
        holiday: holidayInput.checked,
        baseHours: info.baseHours,
        ot910: info.ot910,
        ot11: info.ot11,
        pay: info.pay
      };

      records.push(rec);
      saveToStorage();
      renderRecords();
    });

    function initDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    }

    themeToggleBtn.addEventListener("click", () => {
      const next = currentTheme === "dark" ? "light" : "dark";
      applyTheme(next);
      saveToStorage();
    });

    initDate();
    loadFromStorage();
    renderRecords();
    updateTodayPreview();

    if (!localStorage.getItem(STORAGE_KEY)) {
      applyTheme("light");
    }
</script>
</body>
</html>

