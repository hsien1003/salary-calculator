<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Ning's Salary Â· å°è²“è²“ x å¤§ç‹—ç‹—</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #fff5fb, #f5f7ff);
      --card-bg: #ffffff;
      --accent: #ff8fb3;          /* å°è²“è²“ç²‰ */
      --accent-strong: #ff5f96;
      --accent-dog: #ffb347;      /* å¤§ç‹—ç‹—é‡‘è‰² */
      --accent-soft: rgba(255, 143, 179, 0.1);
      --text-main: #222222;
      --text-muted: #777777;
      --border-subtle: #f0e3f4;
      --danger: #f0625f;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      padding: 14px;
      display: flex;
      justify-content: center;
    }

    main {
      width: 100%;
      max-width: 520px; /* æ‰‹æ©Ÿå„ªå…ˆ */
    }

    header {
      margin-bottom: 14px;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.icon {
      font-size: 1.5rem;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .tagline {
      margin-top: 4px;
      font-size: 0.8rem;
      color: var(--accent-strong);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      padding: 14px 12px;
      margin-bottom: 12px;
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
    }

    .card-title {
      font-size: 0.98rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-title span.badge {
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-strong);
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .field {
      flex: 1 1 140px;
      min-width: 140px;
    }

    label {
      font-size: 0.8rem;
      display: block;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    input[type="date"],
    input[type="time"],
    input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 0.9rem;
      outline: none;
      background: #fff9fd;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input[type="date"]:focus,
    input[type="time"]:focus,
    input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255, 143, 179, 0.4);
      background: #ffffff;
    }

    input[type="checkbox"] {
      transform: scale(1.1);
      margin-right: 6px;
    }

    .checkbox-inline {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 0.85rem;
      margin-top: 4px;
      color: var(--text-main);
    }

    .muted {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      margin-bottom: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 9px;
      border-radius: 999px;
      background: #fff2f7;
      font-size: 0.8rem;
      color: var(--accent-strong);
      border: 1px solid rgba(255, 143, 179, 0.3);
      white-space: nowrap;
    }

    .pill.dog {
      background: #fff7ec;
      color: #bf7b1a;
      border-color: rgba(255, 179, 71, 0.4);
    }

    .pill strong {
      font-weight: 600;
    }

    button {
      padding: 9px 16px;
      border-radius: 999px;
      border: none;
      font-size: 0.9rem;
      cursor: pointer;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-dog));
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(255, 143, 179, 0.45);
      justify-content: center;
    }

    button.primary:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(255, 143, 179, 0.5);
    }

    button.danger {
      background: var(--danger);
      color: #ffffff;
      justify-content: center;
    }

    button:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      margin-top: 6px;
    }

    /* è¨˜éŒ„åˆ—è¡¨è®Šæˆã€Œä¸€æ¢ä¸€æ¢ç°¡æ½”ç‰ˆã€ */
    .records-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .record-card {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: #fffdfd;
      padding: 6px 8px;
      font-size: 0.78rem;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .record-left {
      flex: 1 1 auto;
      min-width: 0;
    }

    .record-date-line {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: 600;
    }

    .record-date-line span.icon {
      font-size: 1rem;
    }

    .record-time {
      font-size: 0.76rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .record-hours {
      font-size: 0.76rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .record-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      white-space: nowrap;
    }

    .record-pay {
      font-size: 0.86rem;
      font-weight: 600;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .record-pay span.icon {
      font-size: 1rem;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .summary-item {
      flex: 1 1 140px;
      min-width: 140px;
      border-radius: 12px;
      background: #fff9fd;
      border: 1px solid var(--border-subtle);
      padding: 6px 8px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .summary-item strong {
      font-size: 0.9rem;
    }

    .summary-label {
      color: var(--text-muted);
    }

    .chip-empty {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding-top: 4px;
    }

    .section-label-small {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-top: 8px;
      margin-bottom: 2px;
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      header h1 {
        font-size: 1.35rem;
      }
      .card {
        padding: 12px 10px;
        border-radius: 16px;
      }
      .row {
        flex-direction: column;
      }
      .field {
        width: 100%;
      }
      .btn-row {
        flex-direction: column;
        align-items: stretch;
      }
      .btn-row button {
        width: 100%;
      }
      .summary-item {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>
        <span class="icon">ğŸ±ğŸ¶</span>
        Ning's Salary
      </h1>
      <p>å°è²“è²“çš„æ‰“å·¥ç­è¡¨ï¼Œäº¤çµ¦å¤§ç‹—ç‹—å¹«å¦³ç®—å¥½è–ªæ°´ã€‚</p>
      <div class="tagline">
        <span>ğŸ’—</span> 10 åˆ†é˜ç‚ºå–®ä½ï¼Œè‡ªå‹•å¹«å¦³åˆ‡ 8 å°æ™‚ / 9â€“10 / 11 å°æ™‚ä»¥ä¸Šã€‚
      </div>
    </header>

    <!-- åŸºæœ¬è¨­å®š -->
    <section class="card">
      <div class="card-title">
        åŸºæœ¬è¨­å®š
        <span class="badge">Step 0</span>
      </div>
      <div class="row">
        <div class="field">
          <label for="wage">æ™‚è–ªï¼ˆå…ƒï¼‰</label>
          <input type="number" id="wage" value="200" min="0" step="1" />
        </div>
      </div>
      <p class="muted">
        ç›®å‰ä»¥æ¯å°æ™‚ <strong id="wagePreview">200</strong> å…ƒè¨ˆç®—ã€‚ä¹‹å¾Œæœ‰èª¿è–ªå†æ”¹é€™è£¡å°±å¥½ã€‚
      </p>
    </section>

    <!-- ä»Šæ—¥è¼¸å…¥ -->
    <section class="card">
      <div class="card-title">
        ä»Šæ—¥ç­åˆ¥è¼¸å…¥
        <span class="badge">Step 1</span>
      </div>
      <div class="row">
        <div class="field">
          <label for="dateInput">æ—¥æœŸ</label>
          <input type="date" id="dateInput" />
        </div>
        <div class="field">
          <label for="startInput">ä¸Šç­æ™‚é–“ï¼ˆ10 åˆ†é˜åˆ»åº¦ï¼‰</label>
          <input type="time" id="startInput" step="600" />
        </div>
        <div class="field">
          <label for="endInput">ä¸‹ç­æ™‚é–“ï¼ˆ10 åˆ†é˜åˆ»åº¦ï¼‰</label>
          <input type="time" id="endInput" step="600" />
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label for="breakInput">ä¼‘æ¯åˆ†é˜æ•¸</label>
          <input type="number" id="breakInput" value="40" min="0" step="10" />
          <div class="muted">ä¼‘æ¯ä¹Ÿæ˜¯ 10 åˆ†é˜ä¸€è·³å°±å¥½ï½</div>
        </div>
        <div class="field" style="align-self:flex-end;">
          <label>&nbsp;</label>
          <div class="checkbox-inline">
            <input type="checkbox" id="holidayInput" />
            <span>åœ‹å®šå‡æ—¥ï¼ˆé›™è–ªï¼‰</span>
          </div>
          <div class="muted">è¼ªç­æ²’æœ‰é€±ä¼‘ï¼Œåªæœ‰åœ‹å®šå‡æ—¥æ‰é›™è–ªã€‚</div>
        </div>
      </div>

      <div class="pill-row">
        <div class="pill">
          ğŸ•’ ä»Šæ—¥å·¥æ™‚ï¼š<strong id="todayHoursText">0 å°æ™‚</strong>
        </div>
        <div class="pill dog">
          ğŸ’° ä»Šæ—¥è–ªæ°´è©¦ç®—ï¼š<strong id="todayPayText">0 å…ƒ</strong>
        </div>
      </div>

      <div class="btn-row">
        <button class="primary" id="addDayBtn">
          â• åŠ å…¥é€™ä¸€å¤©
        </button>
        <span class="muted">
          æœƒå­˜åˆ°ä¸‹é¢ç´€éŒ„ï¼Œä¹‹å¾Œæ‰“é–‹é€™å€‹é é¢ä¹Ÿé‚„åœ¨ã€‚
        </span>
      </div>
    </section>

    <!-- ç¸½çµ + ç°¡åŒ–ç´€éŒ„ -->
    <section class="card">
      <div class="card-title">
        ç¸½çµ & ç´€éŒ„
        <span class="badge">Step 2</span>
      </div>

      <!-- ğŸ” ç¸½çµå…ˆæ”¾æœ€ä¸Šé¢ -->
      <div class="summary-row" id="summaryRow" style="display:none;">
        <div class="summary-item">
          <div class="summary-label">åŸºæœ¬å·¥æ™‚ï¼ˆâ‰¤ 8 å°æ™‚ï¼‰</div>
          <strong id="sumBaseHours">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¬¬ 9ï½10 å°æ™‚</div>
          <strong id="sumOt910">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¬¬ 11 å°æ™‚èµ·</div>
          <strong id="sumOt11">0</strong>
          <span class="muted">å°æ™‚</span>
        </div>
        <div class="summary-item">
          <div class="summary-label">ç¸½è–ªæ°´</div>
          <strong id="sumTotalPay">0</strong>
          <span class="muted">å…ƒ</span>
        </div>
      </div>

      <p class="muted" style="margin-top:6px;">
        é€™é‚Šæ˜¯ç›®å‰æ‰€æœ‰å·²å„²å­˜çš„ã€Œç¸½å·¥æ™‚ & ç¸½è–ªæ°´ã€ï¼Œæ‰“é–‹é é¢å°±å¯ä»¥å…ˆçœ‹åˆ°ã€‚
      </p>

      <div class="section-label-small">æ¯æ—¥ç´€éŒ„</div>
      <div id="emptyHint" class="chip-empty">
        é‚„æ²’æœ‰ä»»ä½•ç´€éŒ„ï¼Œå…ˆåœ¨ä¸Šé¢è¼¸å…¥ä¸€å¤©ç­åˆ¥ï¼ŒæŒ‰ã€ŒåŠ å…¥é€™ä¸€å¤©ã€çœ‹çœ‹å§ã€‚
      </div>

      <div class="records-list" id="recordsList">
        <!-- JS ç”¢ç”Ÿä¸€æ¢ä¸€æ¢ç´€éŒ„ -->
      </div>

      <p class="muted" style="margin-top:6px;">
        æ‰€æœ‰è³‡æ–™åªå­˜åœ¨å¦³é€™æ”¯æ‰‹æ©Ÿï¼é›»è…¦çš„ç€è¦½å™¨è£¡ï¼Œä¸æœƒä¸Šå‚³åˆ°ä»»ä½•åœ°æ–¹ã€‚
      </p>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "ningsSalaryRecords_v2_catdog_compact";

    const wageInput = document.getElementById("wage");
    const wagePreview = document.getElementById("wagePreview");
    const dateInput = document.getElementById("dateInput");
    const startInput = document.getElementById("startInput");
    const endInput = document.getElementById("endInput");
    const breakInput = document.getElementById("breakInput");
    const holidayInput = document.getElementById("holidayInput");

    const todayHoursText = document.getElementById("todayHoursText");
    const todayPayText = document.getElementById("todayPayText");

    const addDayBtn = document.getElementById("addDayBtn");
    const recordsList = document.getElementById("recordsList");

    const sumBaseHoursEl = document.getElementById("sumBaseHours");
    const sumOt910El = document.getElementById("sumOt910");
    const sumOt11El = document.getElementById("sumOt11");
    const sumTotalPayEl = document.getElementById("sumTotalPay");
    const emptyHint = document.getElementById("emptyHint");
    const summaryRow = document.getElementById("summaryRow");

    let records = [];

    function toMinutes(t) {
      if (!t) return null;
      const [h, m] = t.split(":").map(Number);
      return h * 60 + m;
    }

    function roundTo2(x) {
      return Math.round(x * 100) / 100;
    }

    function formatHours(h) {
      return roundTo2(h).toString();
    }

    function formatMoney(n) {
      return Math.round(n).toString();
    }

    // ğŸ”Ÿ åˆ†é˜åˆ»åº¦ï¼šè‡ªå‹•å¸é™„åˆ°æœ€è¿‘ 10 åˆ†é˜
    function snapTimeTo10Minutes(inputEl) {
      const val = inputEl.value;
      if (!val) return;
      let [h, m] = val.split(":").map(Number);
      let rounded = Math.round(m / 10) * 10;
      if (rounded === 60) {
        h = (h + 1) % 24;
        rounded = 0;
      }
      const hh = String(h).padStart(2, "0");
      const mm = String(rounded).padStart(2, "0");
      inputEl.value = `${hh}:${mm}`;
    }

    function calcDay() {
      const wage = parseFloat(wageInput.value) || 0;
      const startMin = toMinutes(startInput.value);
      const endMinRaw = toMinutes(endInput.value);
      const breakMin = parseInt(breakInput.value || "0", 10);
      const isHoliday = holidayInput.checked;

      if (startMin == null || endMinRaw == null || wage <= 0) {
        return {
          valid: false,
          totalHours: 0,
          baseHours: 0,
          ot910: 0,
          ot11: 0,
          pay: 0
        };
      }

      let endMin = endMinRaw;
      if (endMin <= startMin) {
        endMin += 24 * 60; // è·¨å¤œ
      }

      let workedMin = endMin - startMin - breakMin;
      if (workedMin <= 0) {
        workedMin = 0;
      }

      const totalHours = workedMin / 60;
      const baseHours = Math.min(totalHours, 8);
      let remain = Math.max(totalHours - 8, 0);

      const ot910 = Math.min(remain, 2); // ç¬¬ 9ï½10 å°æ™‚
      remain -= ot910;
      const ot11 = Math.max(remain, 0);  // ç¬¬ 11 å°æ™‚èµ·

      const holidayMultiplier = isHoliday ? 2 : 1;
      const basePay = baseHours * wage * holidayMultiplier;
      const ot910Pay = ot910 * wage * 1.33 * holidayMultiplier;
      const ot11Pay = ot11 * wage * 1.66 * holidayMultiplier;
      const pay = basePay + ot910Pay + ot11Pay;

      return {
        valid: true,
        totalHours,
        baseHours,
        ot910,
        ot11,
        pay
      };
    }

    function updateTodayPreview() {
      const info = calcDay();
      todayHoursText.textContent = formatHours(info.totalHours) + " å°æ™‚";
      todayPayText.textContent = formatMoney(info.pay) + " å…ƒ";
      addDayBtn.disabled = !info.valid || info.totalHours <= 0;
    }

    function saveToStorage() {
      try {
        const data = {
          wage: parseFloat(wageInput.value) || 0,
          records
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      } catch (e) {
        console.error("localStorage error:", e);
      }
    }

    function loadFromStorage() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        if (data.wage) {
          wageInput.value = data.wage;
          wagePreview.textContent = data.wage;
        }
        if (Array.isArray(data.records)) {
          records = data.records;
        }
      } catch (e) {
        console.error("localStorage parse error:", e);
      }
    }

    function renderRecords() {
      recordsList.innerHTML = "";

      if (records.length === 0) {
        emptyHint.style.display = "block";
        summaryRow.style.display = "none";
      } else {
        emptyHint.style.display = "none";
        summaryRow.style.display = "flex";
      }

      let sumBase = 0;
      let sum910 = 0;
      let sum11 = 0;
      let sumPay = 0;

      records.forEach((rec, idx) => {
        const card = document.createElement("div");
        card.className = "record-card";

        const left = document.createElement("div");
        left.className = "record-left";

        const dateLine = document.createElement("div");
        dateLine.className = "record-date-line";
        const dateIcon = document.createElement("span");
        dateIcon.className = "icon";
        dateIcon.textContent = "ğŸ“…";
        const dateText = document.createElement("span");
        dateText.textContent = rec.date || "(æœªå¡«æ—¥æœŸ)";
        dateLine.appendChild(dateIcon);
        dateLine.appendChild(dateText);

        const timeEl = document.createElement("div");
        timeEl.className = "record-time";
        timeEl.textContent = `${rec.start} ï½ ${rec.end}` + (rec.holiday ? "ï¼ˆåœ‹å‡ï¼‰" : "");

        const hoursEl = document.createElement("div");
        hoursEl.className = "record-hours";
        hoursEl.textContent =
          `ç¸½ ${formatHours(rec.baseHours + rec.ot910 + rec.ot11)}hï¼›` +
          `åŸºæœ¬ ${formatHours(rec.baseHours)}h / 9â€“10h ${formatHours(rec.ot910)}h / 11+h ${formatHours(rec.ot11)}h`;

        left.appendChild(dateLine);
        left.appendChild(timeEl);
        left.appendChild(hoursEl);

        const right = document.createElement("div");
        right.className = "record-right";

        const payEl = document.createElement("div");
        payEl.className = "record-pay";
        const payIcon = document.createElement("span");
        payIcon.className = "icon";
        payIcon.textContent = "ğŸ’µ";
        const payText = document.createElement("span");
        payText.textContent = formatMoney(rec.pay) + " å…ƒ";
        payEl.appendChild(payIcon);
        payEl.appendChild(payText);

        const delBtn = document.createElement("button");
        delBtn.className = "danger";
        delBtn.textContent = "åˆªé™¤";
        delBtn.addEventListener("click", () => {
          records.splice(idx, 1);
          saveToStorage();
          renderRecords();
        });

        right.appendChild(payEl);
        right.appendChild(delBtn);

        card.appendChild(left);
        card.appendChild(right);
        recordsList.appendChild(card);

        sumBase += rec.baseHours;
        sum910 += rec.ot910;
        sum11 += rec.ot11;
        sumPay += rec.pay;
      });

      sumBaseHoursEl.textContent = formatHours(sumBase);
      sumOt910El.textContent = formatHours(sum910);
      sumOt11El.textContent = formatHours(sum11);
      sumTotalPayEl.textContent = formatMoney(sumPay);
    }

    // ç¶äº‹ä»¶
    wageInput.addEventListener("input", () => {
      const v = parseFloat(wageInput.value) || 0;
      wagePreview.textContent = v;
      updateTodayPreview();
      saveToStorage();
    });

    function handleTimeInputSnap() {
      snapTimeTo10Minutes(this);
      updateTodayPreview();
    }

    startInput.addEventListener("change", handleTimeInputSnap);
    startInput.addEventListener("blur", handleTimeInputSnap);
    endInput.addEventListener("change", handleTimeInputSnap);
    endInput.addEventListener("blur", handleTimeInputSnap);

    dateInput.addEventListener("input", updateTodayPreview);
    breakInput.addEventListener("input", updateTodayPreview);
    holidayInput.addEventListener("change", updateTodayPreview);

    addDayBtn.addEventListener("click", () => {
      snapTimeTo10Minutes(startInput);
      snapTimeTo10Minutes(endInput);
      const info = calcDay();
      if (!info.valid || info.totalHours <= 0) return;

      const rec = {
        date: dateInput.value || "",
        start: startInput.value || "",
        end: endInput.value || "",
        breakMinutes: parseInt(breakInput.value || "0", 10),
        holiday: holidayInput.checked,
        baseHours: info.baseHours,
        ot910: info.ot910,
        ot11: info.ot11,
        pay: info.pay
      };
      records.push(rec);
      saveToStorage();
      renderRecords();
    });

    // é è¨­æ—¥æœŸä»Šå¤©
    (function initDate() {
      const today = new Date();
      const yyyy = today.getFullYear();
      const mm = String(today.getMonth() + 1).padStart(2, "0");
      const dd = String(today.getDate()).padStart(2, "0");
      dateInput.value = `${yyyy}-${mm}-${dd}`;
    })();

    // åˆå§‹åŒ–
    loadFromStorage();
    renderRecords();
    updateTodayPreview();
  </script>
</body>
</html>
